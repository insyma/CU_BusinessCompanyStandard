var templates=[];templates.line='<div class="wk_line clearfix"><h3 class="wk_name" /><h4 class="wk_menge" /><img class="wk_bild" /><input class="wk_input" type="text" /> x <span class="wk_preis_singel" /> <span class="wk_preis" /><span class="wk_delete icon delete" /></div>';$(document).ready(function(){insymaShop.init();user.init();orderProcess.init();$("#form_Standardformular_27268").submit(function(){$("[id^=tab]").find(".bubble_error").html("0").hide();var a=$(".InLineValidate");if(a.length>0){a.each(function(){var b=$(this).parents("ul").attr("data-tab-id");var d=$("#tab_"+b).find(".bubble_error").html();$("#tab_"+b).find(".bubble_error").html(parseInt(d)+1).show()})}})});var insymaShop={_sessionURL:"http://www.contentupdate.net/CU_BusinessCompanyStandard/web/CU_BusinessCompanyStandard/shop/SimpleSessionStore.ashx",_appendBasketSelector:"#seitenleiste",_highlightColor:"#D2EAC5",_warenkorbID:"#warenkorb",init:function(){var a=this;a.drawBasketFromData();$(this._warenkorbID).on("click",".wk_delete",function(){var d=$(this);var b=d.closest(".wk_line").data("parent-id");var c=d.closest(".wk_line").data("detail-id");a.deleteSingleProduct(b,c,d.closest(".wk_line"))});$(this._warenkorbID).on("change",".wk_input",function(){var d=$(this);var b=d.closest(".wk_line").data("parent-id");var c=d.closest(".wk_line").data("detail-id");var e=parseInt(d.val());if(insymaHelper.isNumber(e)){a.updateSingelProduct(b,c,e,d.closest(".wk_line"));d.val(e)}})},drawBasketFromData:function(){var l=JSON.parse(this.getSession());var m=$("#wk_body").html("");var g=0,e=1;if(l.length>0){for(var k in l){var i=$(templates.line).clone();var j=l[k].parentID;var h=l[k].detailID;var a=products[j];var f=products[j][h];var d=parseFloat(l[k].count*f.price);g+=d;i.data("parent-id",j);i.data("detail-id",h);i.find(".wk_name").html(a.name);i.find(".wk_menge").html(f.menge);i.find(".wk_input").val(parseInt(l[k].count));i.find(".wk_preis_singel").html(this.formatPriceWithLabel(parseFloat(f.price)));i.find(".wk_preis").html(this.formatPriceWithLabel(d));var b="";if(a.images.length>0){b=a.images[0];i.find(".wk_bild").prop("src",".."+b)}if(e===1){i.addClass("first")}if(e===l.length){i.addClass("last")}m.append(i);e++}}this.updateTotal(g,l)},addToBasket:function(c,a){var b=$("#shop_menge_"+a).val();$("span[id^='error_value']").fadeOut();if(this.checkInputValue(b)){b=Math.round(b);$("#shop_menge_"+a).val(b);this.addSingelProduct(c,a,b);this.drawBasketFromData();this.hightlight($(this._warenkorbID))}else{$("#error_value_"+a).fadeIn()}},addSingelProduct:function(f,a,e){var d=[];var c=this.getSession();if(c){d=JSON.parse(c);for(var b in d){if(d[b].detailID===a){d[b].count=parseInt(d[b].count)+parseInt(e);this.setSession(JSON.stringify(d));return false}}d.push({parentID:f,detailID:a,count:e});this.setSession(JSON.stringify(d))}else{d.push({parentID:f,detailID:a,count:e});this.setSession(JSON.stringify(d))}},updateSingelProduct:function(g,a,f,d){var e=[];var c=this.getSession();if(c){e=JSON.parse(c);for(var b in e){if(e[b].detailID===a){if(parseInt(f)<1){this.deleteSingleProduct(g,a,d);return true}e[b].count=parseInt(f)}}this.setSession(JSON.stringify(e));this.updateVisual(g,a,f,d);this.updateTotal(undefined,e)}},deleteSingleProduct:function(g,a,e){var f=[];var d=this.getSession();if(d){f=JSON.parse(d);for(var c in f){if(f[c].detailID===a){var b=f.indexOf(f[c]);if(b>-1){f.splice(b,1)}}}this.setSession(JSON.stringify(f));this.deleteVisual(e);this.updateTotal(undefined,f)}},calculateSingleProduct:function(d,a,c){var b=products[d][a];return(parseFloat(b.price)*parseFloat(c)).toFixed(2)},calculateTotal:function(){var g=[];var c=this.getSession();var d=0;if(c){g=JSON.parse(c);for(var b in g){var f=g[b].parentID;var a=g[b].detailID;var e=products[f][a];d+=parseFloat(e.price)*parseFloat(g[b].count)}return d}},calculateKleinmenge:function(a){if(parseFloat(a)<parseFloat(wk_preise.val_shop_kleinmengenzuschlagfrom)){return parseFloat(wk_preise.val_shop_kleinmengenzuschlag)}else{return false}},calculateVersand:function(e,c){var b=false;var a=wk_preise.versandValues;var d=$("input[name='Lieferart']:checked").val();switch(d){case"Noramllieferung":if(c){return wk_preise.val_shop_specversand}break;case"Expresslieferung":if(c){return wk_preise.val_shop_specversandexp}a=wk_preise.expressValues;break;case"abgeholt im Shop":return false;break}for(index in a){if(a[index].bis!=""){if(parseFloat(e)>parseFloat(a[index].von)&&parseFloat(e)<parseFloat(a[index].bis)){b=parseFloat(a[index].preis)}}else{if(parseFloat(e)>parseFloat(a[index].von)){b=parseFloat(a[index].preis)}}}if(b){return b}else{return false}},checkSpecialDelivery:function(d){var a=[];if(d.length>0){for(var b in d){var c=products[d[b].parentID];if(c.specialDelivery==1){a.push(parseInt(c.specialDelivery))}else{a.push(0)}}}if(a.indexOf(0)>=0){return false}else{return true}},updateTotal:function(d,g){var a=$("#wk_footer");var b=0;var f=0;if(g===undefined){var g=JSON.parse(this.getSession())}var h=this.checkSpecialDelivery(g);if(d===undefined){var d=this.calculateTotal();a.find(".wk_sub_total").html(this.formatPriceWithLabel(d))}else{a.find(".wk_sub_total").html(this.formatPriceWithLabel(d))}if(this.calculateKleinmenge(d)&&!h){b=this.calculateKleinmenge(d);a.find(".wk_kleinmengenzuschlag_label").show();a.find(".wk_kleinmengenzuschlag").html(this.formatPriceWithLabel(b)).show()}else{a.find(".wk_kleinmengenzuschlag_label").hide();a.find(".wk_kleinmengenzuschlag").hide()}if(this.calculateVersand(d,h)){f=this.calculateVersand(d,h);a.find(".wk_versandkosten_label").show();a.find(".wk_versandkosten").html(this.formatPriceWithLabel(f)).show()}else{a.find(".wk_versandkosten_label").hide();a.find(".wk_versandkosten").hide()}var c=parseFloat(d)+parseFloat(b)+parseFloat(f);a.find(".wk_total").html(this.formatPriceWithLabel(c));var e={};e.subtotal=this.formatPriceWithLabel(d);e.versandkosten=this.formatPriceWithLabel(f);e.kleinmengenzuschlag=this.formatPriceWithLabel(b);e.gesamtpreis=this.formatPriceWithLabel(c);$("input[name=Gesamtkosten]").val(c.toFixed(2).toString().replace(".",""));$("input[name=Kosten]").val(JSON.stringify(e));$("input[name=Bestellung]").val(JSON.stringify(g));if(parseFloat(d)<=0){this.handleEmptyBasket(true)}else{this.handleEmptyBasket(false)}},deleteVisual:function(a){a.animate({right:-300,opacity:0},function(){$(this).remove();var b=$("#wk_body").find(".wk_line");b.removeClass("first").removeClass("last").each(function(c,d){if(c===0){$(d).addClass("first")}if(c===b.length-1){$(d).addClass("last")}})})},updateVisual:function(e,a,d,b){var c=this.calculateSingleProduct(e,a,d);b.find(".wk_preis").html(this.formatPriceWithLabel(c));b.effect("highlight",{color:this._highlightColor})},handleEmptyBasket:function(a){if(a){$("#wk_emptybasket").show();$("#wk_footer").hide()}else{$("#wk_emptybasket").hide();$("#wk_footer").show()}},hightlight:function(a){a.effect("highlight",{color:this._highlightColor})},checkInputValue:function(a){if(insymaHelper.isNumber(a)){if(a>0){return true}else{return false}}else{return false}},formatPriceWithLabel:function(a){return parseFloat(a).toFixed(2)+" "+wk_labels.lbl_shop_waehrung},setSession:function(a){$.ajax({url:insymaShop._sessionURL,type:"POST",dataType:"html",async:false,data:"ValueToStore="+a,success:function(b){}})},getSession:function(){var b,a=new Date().getTime();$.ajax({dataType:"html",async:false,url:insymaShop._sessionURL+"?t="+a,success:function(c){if(c===""){b=false}else{b=c}}});return b}};var user={_loginURL:"http://www.contentupdate.net/CU_BusinessCompanyStandard/web/CU_BusinessCompanyStandard/services/public/shop/login.ashx",_addressURL:"http://www.contentupdate.net/CU_BusinessCompanyStandard/web/CU_BusinessCompanyStandard/services/public/shop/getAddress.ashx",_sessionURL:"http://www.contentupdate.net/CU_BusinessCompanyStandard/web/CU_BusinessCompanyStandard/shop/UserSessionStore.ashx",init:function(){this.checkLogin()},checkLogin:function(){var a=this.getSession();if(a){a=JSON.parse(a);$("div.login").hide();$("div.logout").show();$("input[name='Zahlungsart']").parent().show();$("input[name=user]").val(JSON.stringify(a))}else{$("div.login").show();$("div.logout").hide()}},login:function(e,a){var d=this,e,b,c=true;$(".error_login_data, .error_login").hide();if($("#login_username").val()==""){$("#login_username").addClass("Validate");c=false}else{e=$("#login_username").val();$("#login_username").removeClass("Validate")}if($("#login_userpass").val()==""){$("#login_userpass").addClass("Validate");c=false}else{b=$("#login_userpass").val();$("#login_userpass").removeClass("Validate")}if(c){$("#loader").show();$.ajax({url:d._loginURL,dataType:"jsonp",type:"GET",crossDomain:true,data:{email:e,password:b},success:function(g){$("#loader").hide();if(g=="-2"||g=="-3"){$(".error_login").show()}if(g=="-4"){$(".error_login_data").show()}if(typeof g=="object"){var f={};f.username=e;f.password=b;f.id=g.ContactId;f.code=g.ContactCode;d.setSession(JSON.stringify(f));d.getAddressShipping(f);d.getAddressBilling(f);$("input[name='Zahlungsart']").parent().show();$("#inhalt .login").hide();$("#inhalt .bestellen").show();$("input[name=user]").val(JSON.stringify(f))}},error:function(){}})}},nologin:function(){$("div.login").hide();$("div.bestellen").show()},logout:function(){this.setSession("");$("div.login").show();$("div.logout").hide()},showOrderForm:function(){var a=this.getSession();if(a){a=JSON.parse(a);$("div.logout").hide();$("div.bestellen").show();this.getAddressShipping(a);this.getAddressBilling(a)}},getAddressShipping:function(a){var b=this;$.ajax({url:b._addressURL,dataType:"jsonp",type:"GET",crossDomain:true,data:{email:a.username,password:a.password,addressType:1},success:function(c){if(c!=-5&&c.Salutation){if(c.Salutation=="Herr"){$('input[name=SalutationID][value="Herr"]').prop("checked",true)}if(c.Salutation=="Frau"){$('input[name=SalutationID][value="Frau"]').prop("checked",true)}$("input[name=SurName]").val(c.LastName);$("input[name=FirstName]").val(c.FirstName);$("input[name=Address]").val(c.Address1);$("input[name=PLZ]").val(c.PostalCode);$("input[name=City]").val(c.City);$("input[name=Telefon]").val(c.Phone);$("input[name=Mobile]").val(c.Mobile);$("input[name=Email]").val(c.EMail)}else{b.getAddressDefault(a)}},error:function(){}})},getAddressDefault:function(a){var b=this;$.ajax({url:b._addressURL,dataType:"jsonp",type:"GET",crossDomain:true,data:{email:a.username,password:a.password},success:function(c){if(c.Salutation=="Herr"){$('input[name=SalutationID][value="Herr"]').prop("checked",true)}if(c.Salutation=="Frau"){$('input[name=SalutationID][value="Frau"]').prop("checked",true)}$("input[name=SurName]").val(c.LastName);$("input[name=FirstName]").val(c.FirstName);$("input[name=Address]").val(c.Address1);$("input[name=PLZ]").val(c.PostalCode);$("input[name=City]").val(c.City);$("input[name=Telefon]").val(c.Phone);$("input[name=Mobile]").val(c.Mobile);$("input[name=Email]").val(c.EMail)},error:function(){}})},getAddressBilling:function(a){var b=this;$.ajax({url:b._addressURL,dataType:"jsonp",type:"GET",crossDomain:true,data:{email:a.username,password:a.password,addressType:0},success:function(c){if(c.Salutation=="Herr"){$('input[name=SalutationID_bill][value="Herr"]').prop("checked",true)}if(c.Salutation=="Frau"){$('input[name=SalutationID_bill][value="Frau"]').prop("checked",true)}$("input[name=SurName_bill]").val(c.LastName);$("input[name=FirstName_bill]").val(c.FirstName);$("input[name=Address_bill]").val(c.Address1);$("input[name=PLZ_bill]").val(c.PostalCode);$("input[name=City_bill]").val(c.City);$("input[name=Telefon_bill]").val(c.Phone);$("input[name=Mobile_bill]").val(c.Mobile);$("input[name=Email_bill]").val(c.EMail)},error:function(){}})},setSession:function(a){$.ajax({url:user._sessionURL,type:"POST",dataType:"html",async:false,data:"ValueToStore="+a,success:function(b){}})},getSession:function(){var b,a=new Date().getTime();$.ajax({dataType:"html",async:false,url:user._sessionURL+"?t="+a,success:function(c){if(c===""){b=false}else{b=c}}});return b}};var orderProcess={init:function(){this.setTabbing();$("input[name='Lieferart']").on("change",function(){insymaShop.updateTotal(undefined,undefined);insymaShop.hightlight($(insymaShop._warenkorbID))})},setTabbing:function(){var c=this;var b=$("ul.steps").find("li");var a=$("a[id^='next_button_']");$("input[name=submitbutton]").hide();b.add(a).on("click",function(){var f=$(this);var d=f.attr("data-type");var e=parseInt(f.attr("data-step"));$("input[name=submitbutton]").hide();if(c.validateStep(e)){b.removeClass("active").removeClass("inactive").addClass("inactive");$("li[id^='tab_"+e+"']").addClass("active");$("ul[id^='tab_content_']").addClass("hide");$("#tab_content_"+e).removeClass("hide");a.hide();$("#next_button_"+(e+1)).show();if(e===4){$("input[name=submitbutton]").show();c.getSummary()}}})},copyDeliveryAddress:function(){$("input[name=SurName_bill]").val($("input[name=SurName]").val());$("input[name=FirstName_bill]").val($("input[name=FirstName]").val());$("input[name=Address_bill]").val($("input[name=Address]").val());$("input[name=PLZ_bill]").val($("input[name=PLZ]").val());$("input[name=City_bill]").val($("input[name=City]").val());$("input[name=Telefon_bill]").val($("input[name=Telefon]").val());$("input[name=Mobile_bill]").val($("input[name=Mobile]").val());$("input[name=Email_bill]").val($("input[name=Email]").val());var a=$("input[name=SalutationID]:checked").val();$('input[name=SalutationID_bill][value="'+a+'"]').prop("checked",true)},getSummary:function(){var b=$("#summary");var a=$("#tab_content_1, #tab_content_2, #tab_content_3");var c="";a.find(">li").each(function(d){var e=$(this);if(e.find("h3").length>0){c+="<li><h4>"+e.find("h3").html()+"</h4></li>"}else{if(e.find("label").length>0){var f="";var g=e.find("input");if(g.length>1){f=e.find("input:checked").val()}else{if(g.length<1){if(e.find("select").length>0){f=e.find("select option:selected").val()}else{f=e.find("textarea").val()}}else{f=g.val()}}c+="<li><label>"+e.find("label").html()+"</label><span>"+f+"</span></li>"}}});b.html(c)},validateStep:function(a){return true}};var insymaHelper={isNumber:function(a){return !isNaN(parseFloat(a))&&isFinite(a)}};